#compile project
$ $ make
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -I/home/umrigar/cs551-17s/include  -c -o common.o common.c
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -I/home/umrigar/cs551-17s/include  -c -o client_main.o client_main.c
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -I/home/umrigar/cs551-17s/include  -c -o client_matmul.o client_matmul.c
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -I/home/umrigar/cs551-17s/include  -c -o mat_test_data.o mat_test_data.c
cc common.o client_main.o client_matmul.o mat_test_data.o -L /home/umrigar/cs551-17s/lib -lcs551 -ldl -o prj3c
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -I/home/umrigar/cs551-17s/include  -c -o server_matmul.o server_matmul.c
cc common.o server_matmul.o -L /home/umrigar/cs551-17s/lib -lcs551 -ldl -o prj3d
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -shared naive_matmul.c -o naive_matmul.mod
cc -g -Wall -D_GNU_SOURCE -std=gnu11 -fPIC -shared smart_matmul.c -o smart_matmul.mod

#create directory in which server should run
$ mkdir server-dir

#start server
$ ./prj3d server-dir
30257

#display usage message for client
$ ./prj3c
usage ./prj3c [<options>] <server-dir> <module> [<filename>...]
  <server-dir> gives the path to the directory used by the
               previously started server
  <module>     is the path to the matrix multiplication module
               used by the worker process created on the server.
               It must be on the server's LD_LIBRARY_PATH.
  A test file <filename> consists of one or more matrices with
  each matrix consisting of whitespace separated DESC NROWS NCOLS
  ENTRY... If no --random or <filename>, then read test from stdin
  Allows <options> are
    --gold | -g
	Only use guaranteed correct gold multiplication;
	do not use test multiplication
    --output | -o
	for each test show multiplicand, multiplier and product matrices
    --random NAME:NROWSxNCOLS | -r NAME:NROWSxNCOLS
	generate random matrix with description "NAME:NROWSxNCOLS"
	with NROWS rows and NCOLS columns
    --seed SEED | -s SEED
	Set seed of random number generator to SEED
    --trace | -t
	Generate trace of test matrix multiplication on stderr

#run client; error because server cannot find module
$ ./prj3c -t -o server-dir naive_matmul.mod matrix.dat 
newMatrixMul(): Can not access a needed shared library

#show LD_LIBRARY_PATH
$ echo $LD_LIBRARY_PATH
.:/home/umrigar/cs551-17s/lib

#since . is in LD_LIBRARY_PATH, copy modules to server-dir.
$ cp -p *.mod server-dir

#run client using naive_matmul.mod with trace and output
#using test data from matrix.dat
$ ./prj3c -t -o server-dir naive_matmul.mod matrix.dat 
utime: 0, stime: 0, wall: 0
multiplicand A[3][3] 
       1      -2      -3
       4      -5       6
       7       8      -9
multiplier A[3][3] 
       1      -2      -3
       4      -5       6
       7       8      -9
product: A[3][3]  x  A[3][3] 
     -28     -16      12
      26      65     -96
     -24    -126     108
------------
utime: 0, stime: 0, wall: 0
multiplicand A[3][3] 
       1      -2      -3
       4      -5       6
       7       8      -9
multiplier B[3][3] 
      12      34      56
       1       2       3
      -1      -2      -3
product: A[3][3]  x  B[3][3] 
      13      36      59
      37     114     191
     101     272     443
------------
utime: 0, stime: 0, wall: 0
multiplicand B[3][3] 
      12      34      56
       1       2       3
      -1      -2      -3
multiplier A[3][3] 
       1      -2      -3
       4      -5       6
       7       8      -9
product: B[3][3]  x  A[3][3] 
     540     254    -336
      30      12     -18
     -30     -12      18
------------
utime: 0, stime: 0, wall: 0
multiplicand B[3][3] 
      12      34      56
       1       2       3
      -1      -2      -3
multiplier B[3][3] 
      12      34      56
       1       2       3
      -1      -2      -3
product: B[3][3]  x  B[3][3] 
     122     364     606
      11      32      53
     -11     -32     -53
------------

#run client using smart_matmul.mod with trace
#using test data from matrix.dat
$ ./prj3c -t  server-dir smart_matmul.mod matrix.dat 
utime: 0, stime: 0, wall: 0
utime: 0, stime: 0, wall: 0
utime: 0, stime: 0, wall: 0
utime: 0, stime: 0, wall: 0

#run client repeatedly using naive_matmul.mod on 1000x1000 random matrix
$ for s in $(seq 1 3); do echo "**** $s ****"; ./prj3c -t -r rand1000x1000:1000x1000  server-dir naive_matmul.mod; done
**** 1 ****
utime: 1387, stime: 0, wall: 1389
**** 2 ****
utime: 1336, stime: 2, wall: 1339
**** 3 ****
utime: 1345, stime: 0, wall: 1346

#run client repeatedly using smart_matmul.mod on 1000x1000 random matrix
$ for s in $(seq 1 3); do echo "**** $s ****"; ./prj3c -t -r rand1000x1000:1000x1000  server-dir smart_matmul.mod; done
**** 1 ****
utime: 491, stime: 1, wall: 493
**** 2 ****
utime: 512, stime: 0, wall: 513
**** 3 ****
utime: 505, stime: 2, wall: 507

#server-dir is clean as expected
$ ls server-dir
naive_matmul.mod  REQUESTS  smart_matmul.mod

#look for server's PID
$ ps -ef | grep prj3d
umrigar  30257     1  0 02:40 ?        00:00:00 ./prj3d server-dir
umrigar  30318 30168  0 02:47 pts/21   00:00:00 grep prj3d

#terminate server uncleanly
$ kill 30257

#show server process gone
$ ps -ef | grep prj3d
umrigar  30332 30168  0 02:47 pts/21   00:00:00 grep prj3d
$
